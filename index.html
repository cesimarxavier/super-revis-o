<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Desafio Tit√£ - 3¬∫ Ano</title>

    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4ECDC4">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="icon-192.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Fredoka', 'sans-serif'] },
                    colors: {
                        'brand-blue': '#4ECDC4',
                        'brand-yellow': '#FFE66D',
                        'brand-red': '#FF6B6B',
                        'brand-purple': '#6D28D9', // Cor do Tit√£
                        'titan-gold': '#F59E0B',
                    },
                    animation: {
                        'bounce-subtle': 'bounce 2s infinite',
                        'pulse-fast': 'pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #F3F4F6;
            background-image: radial-gradient(#D1D5DB 2px, transparent 2px);
            background-size: 24px 24px;
            /* Previne sele√ß√£o e zoom indesejado em toques r√°pidos */
            touch-action: manipulation;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            padding-bottom: 100px;
            /* Espa√ßo para a barra fixa */
        }

        .btn-push {
            transition: transform 0.1s, border-bottom-width 0.1s;
            border-bottom-width: 4px;
        }

        .btn-push:active {
            transform: translateY(4px);
            border-bottom-width: 0px;
        }

        .titan-glow {
            box-shadow: 0 0 15px rgba(109, 40, 217, 0.5);
            border: 2px solid #C4B5FD;
        }

        /* Anima√ß√µes de transi√ß√£o */
        .slide-up {
            animation: slideUp 0.4s ease-out;
        }

        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
    </style>
</head>

<body class="font-sans text-gray-700 min-h-screen flex flex-col items-center">

    <header
        class="w-full bg-white p-3 shadow-md border-b-4 border-gray-200 sticky top-0 z-40 flex justify-between items-center max-w-lg mx-auto rounded-b-xl">
        <div class="flex items-center gap-2" onclick="renderMap()">
            <div class="bg-blue-100 p-2 rounded-full text-xl cursor-pointer">üîô</div>
            <div>
                <p class="text-[10px] uppercase font-bold text-gray-400">Pontos</p>
                <p class="text-xl font-black text-brand-purple" id="header-score">0</p>
            </div>
        </div>
        <div class="flex items-center gap-2">
            <div class="text-right">
                <p class="text-[10px] uppercase font-bold text-gray-400">N√≠vel Atual</p>
                <p class="text-sm font-bold text-brand-blue" id="header-rank">Iniciante</p>
            </div>
            <div class="text-2xl animate-bounce-subtle">üê£</div>
        </div>
    </header>

    <main id="app" class="w-full max-w-lg p-4 flex-grow flex flex-col items-center"></main>

    <div id="action-bar"
        class="fixed bottom-0 left-0 w-full bg-white border-t-4 border-gray-200 p-4 z-50 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] hidden">
        <div class="max-w-lg mx-auto" id="action-content">
        </div>
    </div>

    <script>
        // --- BANCO DE QUEST√ïES OTIMIZADO (5-4-3) ---
        // Estrutura: T√≥pico -> N√≠veis [0,1,2] -> Quest√µes

        const topics = [
            {
                id: "pronomes",
                title: "Pronomes",
                icon: "üéí",
                color: "bg-blue-400",
                levels: [
                    {
                        name: "B√°sico",
                        qCount: 5,
                        questions: [
                            { q: "Eu gosto da **minha** escola. A palavra 'minha' diz que a escola √© de quem?", options: ["De quem est√° falando (Eu)", "Da escola", "De outra pessoa", "De ningu√©m"], correct: 0, feedback: "Isso! 'Minha' significa que √© sua." },
                            { q: "Qual palavra usamos para mostrar algo que est√° **longe**?", options: ["Este", "Esse", "Aquele", "Meu"], correct: 2, feedback: "'Aquele' aponta para longe. Aquele p√°ssaro no c√©u!" },
                            { q: "O cachorro √© **nosso**. Quem √© o dono?", options: ["S√≥ eu", "S√≥ voc√™", "N√≥s dois", "Eles"], correct: 2, feedback: "Nosso = meu + seu. Pertence a n√≥s!" },
                            { q: "A frase 'Eu fui ao parque'. Quem foi ao parque?", options: ["Eu", "Tu", "Ele", "N√≥s"], correct: 0, feedback: "Est√° escrito 'Eu' fui." },
                            { q: "Qual dessas palavras indica **posse** (ser dono)?", options: ["Aquele", "Este", "Teu", "Eu"], correct: 2, feedback: "'Teu' indica que √© seu. Teu brinquedo." }
                        ]
                    },
                    {
                        name: "M√©dio",
                        qCount: 4,
                        questions: [
                            { q: "A bola est√° na m√£o do menino. Ele diz: Essa bola ou Esta bola?", options: ["Esta bola (perto dele)", "Essa bola (perto do outro)", "Aquela bola (longe)", "Sua bola"], correct: 0, feedback: "Se est√° na m√£o de quem fala, √© **ESTA**." },
                            { q: "Complete: Voc√™ perdeu o ______ l√°pis?", options: ["meu", "teu", "nosso", "ele"], correct: 1, feedback: "Quem fala 'Voc√™' ou 'Tu', usa 'Teu' ou 'Seu'." },
                            { q: "M√£e, pega ______ toalha a√≠ do seu lado?", options: ["esta", "essa", "aquela", "minha"], correct: 1, feedback: "Se est√° do lado de quem escuta (a m√£e), √© **ESSA**." },
                            { q: "N√≥s arrumamos a ______ sala.", options: ["nossa", "sua", "tua", "minha"], correct: 0, feedback: "N√≥s cuidamos do que √© **NOSSO**." }
                        ]
                    },
                    {
                        name: "TIT√É ‚ö°",
                        qCount: 3,
                        questions: [
                            { q: "Desafio: 'Tu e eu somos amigos. O segredo √© ______'.", options: ["teu", "meu", "nosso", "deles"], correct: 2, feedback: "Tu + Eu = N√≥s. Ent√£o o segredo √© **NOSSO**." },
                            { q: "Qual frase est√° correta?", options: ["Este aqui √© meu pai.", "Esse aqui √© meu pai.", "Aquele aqui √© meu pai.", "Aquilo aqui √© meu pai."], correct: 0, feedback: "Se o pai est√° 'aqui' (perto), usamos **ESTE**." },
                            { q: "Analise: 'Vendi meu carro para ele'. De quem era o carro antes?", options: ["Dele", "Meu", "Nosso", "Do carro"], correct: 1, feedback: "O carro era **MEU** antes de vender." }
                        ]
                    }
                ]
            },
            {
                id: "sz",
                title: "Uso do S e Z",
                icon: "üêç",
                color: "bg-yellow-400",
                levels: [
                    {
                        name: "B√°sico",
                        qCount: 5,
                        questions: [
                            { q: "Qual o nome do objeto onde moramos?", options: ["Caza", "Casa", "Ca√ßa", "Kasa"], correct: 1, feedback: "Casa se escreve com S." },
                            { q: "O som do S em 'Mesa' parece com qual letra?", options: ["Z", "J", "X", "C"], correct: 0, feedback: "Mesa tem som de Z, mas escreve com S." },
                            { q: "Qual est√° certo?", options: ["Azul", "Asul", "A√ßul", "Axul"], correct: 0, feedback: "Azul √© com Z!" },
                            { q: "Zebra come√ßa com...", options: ["S", "Z", "C", "X"], correct: 1, feedback: "Zebra √© com Z." },
                            { q: "Vaso de flor. Como escreve?", options: ["Vazo", "Vaso", "Va√ßo", "Vasso"], correct: 1, feedback: "Vaso √© com S." }
                        ]
                    },
                    {
                        name: "M√©dio",
                        qCount: 4,
                        questions: [
                            { q: "Princesa e Duquesa terminam com...", options: ["EZA", "ESA", "E√áA", "EZZA"], correct: 1, feedback: "T√≠tulos femininos terminam em ESA." },
                            { q: "Beleza vem de belo. Escrevemos com:", options: ["Z", "S", "SS", "√á"], correct: 0, feedback: "Qualidades que viram nomes (Belo -> Beleza) usamos Z." },
                            { q: "Japon√™s, Franc√™s, Ingl√™s. Terminam com:", options: ["√äS", "√äZ", "EIZ", "ES"], correct: 0, feedback: "Nacionalidades usamos √äS." },
                            { q: "Pousada vem de pousar. √â com S ou Z?", options: ["S", "Z", "√á", "SS"], correct: 0, feedback: "Se pousar √© com S, pousada tamb√©m √©." }
                        ]
                    },
                    {
                        name: "TIT√É ‚ö°",
                        qCount: 3,
                        questions: [
                            { q: "Desafio: Qual par est√° correto?", options: ["Riqueza e Pobreza", "Riquesa e Pobresa", "Riqueza e Pobresa", "Riquesa e Pobreza"], correct: 0, feedback: "As duas palavras usam Z (Rico->Riqueza, Pobre->Pobreza)." },
                            { q: "Analise: 'Ele quis fazer caf√©'. Quis √© com:", options: ["S", "Z", "X", "√á"], correct: 0, feedback: "Quis (verbo querer) √© sempre com S." },
                            { q: "Pesquisa se escreve com S. E Pesquisar?", options: ["Com S", "Com Z", "Muda para Z", "Com √á"], correct: 0, feedback: "A fam√≠lia continua igual! Pesquisa -> Pesquisar (tudo S)." }
                        ]
                    }
                ]
            },
            // Adicione os outros t√≥picos (Verbo, LH/LI, etc) seguindo a estrutura acima...
            // Para testar, os t√≥picos abaixo s√£o placeholders funcionais
            { id: "verbos", title: "Verbos", icon: "üèÉ", color: "bg-green-400", levels: [{ name: "B√°sico", qCount: 5, questions: Array(5).fill({ q: "Exemplo de Verbo:", options: ["Correr", "Azul", "Mesa", "Ar"], correct: 0, feedback: "A√ß√£o!" }) }, { name: "M√©dio", qCount: 4, questions: Array(4).fill({ q: "Exemplo M√©dio", options: ["A", "B", "C", "D"], correct: 0, feedback: "Explica√ß√£o" }) }, { name: "TIT√É ‚ö°", qCount: 3, questions: Array(3).fill({ q: "Exemplo Tit√£", options: ["A", "B", "C", "D"], correct: 0, feedback: "Explica√ß√£o" }) }] },
            { id: "lhli", title: "LH e LI", icon: "üêá", color: "bg-purple-400", levels: [{ name: "B√°sico", qCount: 5, questions: Array(5).fill({ q: "Exemplo LH:", options: ["A", "B", "C", "D"], correct: 0, feedback: "A√ß√£o!" }) }, { name: "M√©dio", qCount: 4, questions: Array(4).fill({ q: "Exemplo M√©dio", options: ["A", "B", "C", "D"], correct: 0, feedback: "Explica√ß√£o" }) }, { name: "TIT√É ‚ö°", qCount: 3, questions: Array(3).fill({ q: "Exemplo Tit√£", options: ["A", "B", "C", "D"], correct: 0, feedback: "Explica√ß√£o" }) }] },
            { id: "tempos", title: "Passado/Futuro", icon: "‚è∞", color: "bg-red-400", levels: [{ name: "B√°sico", qCount: 5, questions: Array(5).fill({ q: "Exemplo Tempo:", options: ["A", "B", "C", "D"], correct: 0, feedback: "A√ß√£o!" }) }, { name: "M√©dio", qCount: 4, questions: Array(4).fill({ q: "Exemplo M√©dio", options: ["A", "B", "C", "D"], correct: 0, feedback: "Explica√ß√£o" }) }, { name: "TIT√É ‚ö°", qCount: 3, questions: Array(3).fill({ q: "Exemplo Tit√£", options: ["A", "B", "C", "D"], correct: 0, feedback: "Explica√ß√£o" }) }] },
            { id: "sujeito", title: "Sujeito", icon: "üîç", color: "bg-teal-400", levels: [{ name: "B√°sico", qCount: 5, questions: Array(5).fill({ q: "Exemplo Sujeito:", options: ["A", "B", "C", "D"], correct: 0, feedback: "A√ß√£o!" }) }, { name: "M√©dio", qCount: 4, questions: Array(4).fill({ q: "Exemplo M√©dio", options: ["A", "B", "C", "D"], correct: 0, feedback: "Explica√ß√£o" }) }, { name: "TIT√É ‚ö°", qCount: 3, questions: Array(3).fill({ q: "Exemplo Tit√£", options: ["A", "B", "C", "D"], correct: 0, feedback: "Explica√ß√£o" }) }] },
            { id: "cedilha", title: "Cedilha", icon: "üé™", color: "bg-pink-400", levels: [{ name: "B√°sico", qCount: 5, questions: Array(5).fill({ q: "Exemplo Cedilha:", options: ["A", "B", "C", "D"], correct: 0, feedback: "A√ß√£o!" }) }, { name: "M√©dio", qCount: 4, questions: Array(4).fill({ q: "Exemplo M√©dio", options: ["A", "B", "C", "D"], correct: 0, feedback: "Explica√ß√£o" }) }, { name: "TIT√É ‚ö°", qCount: 3, questions: Array(3).fill({ q: "Exemplo Tit√£", options: ["A", "B", "C", "D"], correct: 0, feedback: "Explica√ß√£o" }) }] },
        ];

        // --- ESTADO DO JOGO ---
        let gameState = {
            progress: JSON.parse(localStorage.getItem('titaProgress')) || {}, // Guarda quais n√≠veis foram completados
            score: parseInt(localStorage.getItem('titaScore')) || 0,
            currentTopicIdx: 0,
            currentLevelIdx: 0,
            questionIdx: 0,
            mistakes: 0 // Para dar feedback se errar muito
        };

        const app = document.getElementById('app');
        const actionBar = document.getElementById('action-bar');
        const actionContent = document.getElementById('action-content');
        const scoreDisplay = document.getElementById('header-score');

        // --- FUN√á√ïES DE NAVEGA√á√ÉO ---

        function saveProgress() {
            localStorage.setItem('titaProgress', JSON.stringify(gameState.progress));
            localStorage.setItem('titaScore', gameState.score.toString());
            scoreDisplay.innerText = gameState.score;
        }

        function renderMap() {
            saveProgress();
            actionBar.classList.add('hidden'); // Esconde barra no mapa

            app.innerHTML = `
                <div class="w-full mb-6 text-center slide-up">
                    <h1 class="text-2xl font-black text-gray-800 mb-1">Mapa do Mundo</h1>
                    <p class="text-sm text-gray-500">Escolha seu desafio!</p>
                </div>
                <div class="w-full grid gap-4 pb-20 slide-up">
                    ${topics.map((topic, tIdx) => {
                return `
                        <div class="bg-white rounded-2xl p-4 shadow-sm border-2 border-gray-100">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="${topic.color} w-12 h-12 rounded-xl flex items-center justify-center text-2xl text-white shadow-sm">
                                    ${topic.icon}
                                </div>
                                <h2 class="text-lg font-bold text-gray-700">${topic.title}</h2>
                            </div>
                            
                            <div class="flex gap-2">
                                ${topic.levels.map((lvl, lIdx) => {
                    // L√≥gica de Bloqueio
                    const levelId = `${tIdx}-${lIdx}`;
                    const prevLevelId = `${tIdx}-${lIdx - 1}`;
                    const isCompleted = gameState.progress[levelId];

                    // N√≠vel 0 sempre aberto. Outros dependem do anterior.
                    let isLocked = lIdx > 0 && !gameState.progress[prevLevelId];

                    // Estilo do bot√£o
                    let btnColor = isLocked ? 'bg-gray-100 text-gray-400 border-gray-200' :
                        isCompleted ? 'bg-green-100 text-green-700 border-green-300' :
                            lIdx === 2 ? 'bg-purple-100 text-purple-700 border-purple-300' : 'bg-blue-50 text-blue-600 border-blue-200';

                    let icon = isLocked ? 'üîí' : isCompleted ? '‚úÖ' : lIdx === 2 ? '‚ö°' : (lIdx + 1);

                    return `
                                    <button onclick="${isLocked ? '' : `startLevel(${tIdx}, ${lIdx})`}" 
                                        class="flex-1 py-3 rounded-xl font-bold border-b-4 text-sm transition-all ${btnColor} ${isLocked ? '' : 'active:border-b-0 active:translate-y-1'}">
                                        <div class="text-xs uppercase mb-1 opacity-70">${lvl.name}</div>
                                        <div class="text-lg">${icon}</div>
                                    </button>
                                    `;
                }).join('')}
                            </div>
                        </div>
                        `;
            }).join('')}
                </div>
            `;
            window.scrollTo(0, 0);
        }

        // --- MOTOR DO JOGO ---

        function startLevel(tIdx, lIdx) {
            gameState.currentTopicIdx = tIdx;
            gameState.currentLevelIdx = lIdx;
            gameState.questionIdx = 0;
            gameState.mistakes = 0;
            renderQuestion();
        }

        function renderQuestion() {
            const topic = topics[gameState.currentTopicIdx];
            const level = topic.levels[gameState.currentLevelIdx];
            const question = level.questions[gameState.questionIdx];

            const isTitan = gameState.currentLevelIdx === 2;

            // Barra de progresso
            const progressPct = ((gameState.questionIdx) / level.questions.length) * 100;

            app.innerHTML = `
                <div class="w-full mb-6 px-1">
                    <div class="flex justify-between text-xs font-bold text-gray-400 uppercase mb-1">
                        <span>${isTitan ? 'Modo Tit√£' : level.name}</span>
                        <span>${gameState.questionIdx + 1}/${level.questions.length}</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
                        <div class="h-full transition-all duration-300 ${isTitan ? 'bg-brand-purple' : 'bg-brand-blue'}" style="width: ${progressPct}%"></div>
                    </div>
                </div>

                <div class="w-full bg-white rounded-3xl p-6 shadow-lg border-2 ${isTitan ? 'border-purple-200 titan-glow' : 'border-gray-100'} slide-up mb-24">
                    ${isTitan ? '<div class="text-center text-xs font-bold text-purple-600 uppercase tracking-widest mb-2">‚ö° Pergunta Lend√°ria</div>' : ''}
                    
                    <h2 class="text-xl md:text-2xl font-bold text-gray-800 mb-6 leading-snug text-center">
                        ${question.q.replace(/\*\*(.*?)\*\*/g, '<span class="text-brand-blue">$1</span>')}
                    </h2>

                    <div class="grid gap-3" id="options-grid">
                        ${question.options.map((opt, idx) => `
                            <button onclick="selectOption(${idx})" id="btn-opt-${idx}"
                                class="w-full text-left p-4 rounded-xl border-2 border-gray-200 bg-gray-50 font-bold text-gray-600 transition-all active:scale-95 hover:bg-blue-50">
                                ${opt}
                            </button>
                        `).join('')}
                    </div>
                </div>
            `;

            // Resetar Barra de A√ß√£o
            actionBar.classList.remove('hidden');
            actionContent.innerHTML = `
                <button class="w-full bg-gray-200 text-gray-400 font-bold py-4 rounded-xl text-lg cursor-not-allowed" disabled>
                    Escolha uma resposta
                </button>
            `;
            window.scrollTo(0, 0);
        }

        let selectedIdx = null;

        function selectOption(idx) {
            // Remove sele√ß√£o anterior
            document.querySelectorAll('[id^="btn-opt-"]').forEach(btn => {
                btn.classList.remove('border-brand-blue', 'bg-blue-100', 'text-brand-blue');
                btn.classList.add('border-gray-200', 'bg-gray-50', 'text-gray-600');
            });

            // Aplica nova sele√ß√£o
            const btn = document.getElementById(`btn-opt-${idx}`);
            btn.classList.remove('border-gray-200', 'bg-gray-50', 'text-gray-600');
            btn.classList.add('border-brand-blue', 'bg-blue-100', 'text-brand-blue');

            selectedIdx = idx;

            // Ativa bot√£o de confirmar na barra fixa
            actionContent.innerHTML = `
                <button onclick="checkAnswer()" class="w-full bg-brand-blue hover:bg-teal-500 text-white font-bold py-4 rounded-xl text-lg btn-push shadow-lg">
                    VERIFICAR
                </button>
            `;
        }

        function checkAnswer() {
            const topic = topics[gameState.currentTopicIdx];
            const level = topic.levels[gameState.currentLevelIdx];
            const question = level.questions[gameState.questionIdx];
            const isCorrect = selectedIdx === question.correct;

            // Trava op√ß√µes
            const allBtns = document.querySelectorAll('[id^="btn-opt-"]');
            allBtns.forEach(btn => btn.disabled = true);

            // Visual nas op√ß√µes
            const selBtn = document.getElementById(`btn-opt-${selectedIdx}`);
            const corrBtn = document.getElementById(`btn-opt-${question.correct}`);

            if (isCorrect) {
                selBtn.className = "w-full text-left p-4 rounded-xl border-2 border-green-500 bg-green-100 text-green-700 font-bold";
                gameState.score += 10;
                saveProgress();
                playSound('correct');
            } else {
                selBtn.className = "w-full text-left p-4 rounded-xl border-2 border-red-400 bg-red-100 text-red-700 font-bold opacity-60";
                corrBtn.className = "w-full text-left p-4 rounded-xl border-2 border-green-500 bg-green-100 text-green-700 font-bold animate-pulse";
                gameState.mistakes++;
                playSound('wrong');
            }

            // Feedback na Barra Fixa (PEDAGOGIA: Feedback Imediato)
            const isLast = gameState.questionIdx === level.questions.length - 1;

            // Muda cor da barra dependendo do acerto/erro
            actionBar.className = `fixed bottom-0 left-0 w-full p-4 z-50 border-t-4 shadow-lg ${isCorrect ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200'}`;

            actionContent.innerHTML = `
                <div class="flex flex-col gap-3">
                    <div class="flex items-start gap-3">
                        <div class="text-3xl">${isCorrect ? 'üéâ' : 'ü§î'}</div>
                        <div>
                            <p class="font-black ${isCorrect ? 'text-green-700' : 'text-red-700'} uppercase text-sm">
                                ${isCorrect ? 'Mandou bem!' : 'Ops, corre√ß√£o:'}
                            </p>
                            <p class="text-gray-700 text-sm leading-tight font-medium">${question.feedback}</p>
                        </div>
                    </div>
                    <button onclick="${isLast ? 'finishLevel()' : 'nextQuestion()'}" 
                        class="w-full ${isCorrect ? 'bg-green-500 hover:bg-green-600' : 'bg-red-500 hover:bg-red-600'} text-white font-bold py-3 rounded-xl text-lg btn-push shadow-md uppercase tracking-wider">
                        ${isLast ? 'Concluir' : 'Continuar'}
                    </button>
                </div>
            `;
        }

        function nextQuestion() {
            gameState.questionIdx++;
            renderQuestion();
        }

        // --- TELA DE VIT√ìRIA / DECIS√ÉO ---
        function finishLevel() {
            // Salva Progresso
            const levelId = `${gameState.currentTopicIdx}-${gameState.currentLevelIdx}`;
            gameState.progress[levelId] = true;
            saveProgress();

            const topic = topics[gameState.currentTopicIdx];
            const nextLevelIdx = gameState.currentLevelIdx + 1;
            const hasNextLevel = nextLevelIdx < topic.levels.length;
            const nextTopicIdx = gameState.currentTopicIdx + 1;
            const hasNextTopic = nextTopicIdx < topics.length;

            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
            playSound('win');

            actionBar.classList.add('hidden'); // Esconde barra fixa na tela de vit√≥ria

            // TELA DE DECIS√ÉO (PEDAGOGIA: Autonomia)
            app.innerHTML = `
                <div class="text-center mt-10 slide-up max-w-sm">
                    <div class="text-6xl mb-4 animate-bounce-subtle">üèÜ</div>
                    <h2 class="text-3xl font-black text-gray-800 mb-2">N√≠vel Completo!</h2>
                    <p class="text-gray-500 mb-8">Voc√™ ganhou +${gameState.score} pontos!</p>

                    <div class="grid gap-4 w-full">
                        ${hasNextLevel ? `
                            <button onclick="startLevel(${gameState.currentTopicIdx}, ${nextLevelIdx})" 
                                class="w-full bg-brand-purple text-white p-5 rounded-2xl shadow-xl btn-push flex items-center justify-between group relative overflow-hidden">
                                <div class="absolute inset-0 bg-white opacity-10 transform -translate-x-full group-hover:translate-x-0 transition-transform duration-500"></div>
                                <div class="text-left">
                                    <p class="text-xs uppercase opacity-80 font-bold">Desafio Aceito</p>
                                    <p class="text-xl font-bold">Pr√≥ximo N√≠vel: ${topic.levels[nextLevelIdx].name}</p>
                                </div>
                                <span class="text-3xl">‚¨ÜÔ∏è</span>
                            </button>
                        ` : `
                             <div class="bg-yellow-100 p-4 rounded-xl text-yellow-800 font-bold border-2 border-yellow-300">
                                üëë Voc√™ dominou este assunto! (Tit√£)
                             </div>
                        `}

                        ${hasNextTopic ? `
                            <button onclick="startLevel(${nextTopicIdx}, 0)" 
                                class="w-full bg-white border-2 border-gray-200 text-gray-600 p-4 rounded-2xl shadow-sm btn-push flex items-center justify-between hover:bg-gray-50">
                                <div class="text-left">
                                    <p class="text-xs uppercase opacity-60 font-bold">Mudar de Assunto</p>
                                    <p class="text-lg font-bold text-gray-800">Ir para: ${topics[nextTopicIdx].title}</p>
                                </div>
                                <span class="text-2xl">‚û°</span>
                            </button>
                        ` : ''}

                        <button onclick="renderMap()" class="text-gray-400 font-bold py-4">Voltar ao Mapa</button>
                    </div>
                </div>
            `;
        }

        // --- EFEITOS SONOROS (Simulados) ---
        function playSound(type) {
            // Aqui voc√™ pode adicionar sons reais usando Audio()
            // Por enquanto √© visual/l√≥gico
        }

        // Init
        renderMap();
        scoreDisplay.innerText = gameState.score;

    </script>
</body>

</html>