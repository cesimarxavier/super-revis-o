<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mestre do Saber - 3¬∫ Ano</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Fredoka', 'sans-serif'] },
                    colors: {
                        'hero-blue': '#3B82F6',
                        'hero-purple': '#8B5CF6',
                        'hero-green': '#10B981',
                        'hero-yellow': '#F59E0B',
                        'hero-red': '#EF4444',
                        'bg-soft': '#F3F4F6',
                    },
                    boxShadow: {
                        'btn': '0 4px 0 0 rgba(0, 0, 0, 0.1)',
                        'btn-active': '0 0px 0 0 rgba(0, 0, 0, 0.1)',
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #F3F4F6;
            background-image: radial-gradient(#E5E7EB 2px, transparent 2px);
            background-size: 20px 20px;
            /* Previne sele√ß√£o de texto e zoom duplo no celular */
            user-select: none;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            padding-bottom: 140px;
            /* Espa√ßo seguro para o rodap√© fixo */
        }

        /* Bot√£o com efeito de "apertar" */
        .btn-press {
            transition: all 0.1s;
            transform: translateY(0);
            border-bottom-width: 4px;
        }

        .btn-press:active {
            transform: translateY(4px);
            border-bottom-width: 0px;
            box-shadow: none;
        }

        /* Anima√ß√µes */
        .slide-up {
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .pop-in {
            animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes popIn {
            from {
                transform: scale(0.5);
                opacity: 0;
            }

            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* Rodap√© Fixo */
        .fixed-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.05);
            z-index: 50;
            padding-bottom: env(safe-area-inset-bottom);
            /* Para iPhones novos */
        }
    </style>
</head>

<body class="font-sans text-gray-700 min-h-screen flex flex-col items-center">

    <header
        class="w-full bg-white p-3 shadow-sm border-b-2 border-gray-100 sticky top-0 z-40 flex justify-between items-center max-w-md mx-auto">
        <div class="flex items-center gap-2" id="header-left">
        </div>
        <div class="bg-yellow-100 px-3 py-1 rounded-full border border-yellow-200 flex items-center gap-1">
            <span>‚≠ê</span>
            <span id="score-display" class="font-bold text-yellow-700">0</span>
        </div>
    </header>

    <main id="app" class="w-full max-w-md p-4 flex-grow flex flex-col items-center"></main>

    <div id="footer-action" class="fixed-footer hidden">
        <div class="max-w-md mx-auto p-4 w-full" id="footer-content">
        </div>
    </div>

    <script>
        // --- CONTE√öDO PEDAG√ìGICO OTIMIZADO (5-4-3) ---
        const quizData = [
            {
                id: "pronomes",
                title: "Pronomes",
                icon: "üéí",
                color: "bg-blue-500",
                description: "Meu, Teu, Este, Aquele",
                levels: [
                    // N√çVEL 1: F√ÅCIL (5 Quest√µes) - Foco: Identificar posse e lugar b√°sico
                    {
                        name: "Iniciante",
                        questions: [
                            { q: "Se a bola √© <strong>minha</strong>, quem √© o dono?", options: ["Eu", "Voc√™", "N√≥s", "Eles"], correct: 0, hint: "Minha = Eu." },
                            { q: "Qual palavra usamos para apontar algo que est√° <strong>longe</strong>?", options: ["Este", "Esse", "Aquele", "Meu"], correct: 2, hint: "Longe = Aquele l√°√°√° longe." },
                            { q: "O cachorro √© <strong>nosso</strong>. Quem s√£o os donos?", options: ["Eu sozinho", "Voc√™ sozinho", "N√≥s dois", "Ningu√©m"], correct: 2, hint: "Nosso pertence a n√≥s." },
                            { q: "Qual palavra indica posse (ser dono)?", options: ["Aquele", "L√°", "Teu", "Onde"], correct: 2, hint: "Teu caderno, teu brinquedo." },
                            { q: "Eu perdi <strong>meu</strong> l√°pis. A palavra 'meu' √© um pronome...", options: ["Possessivo (dono)", "Demonstrativo (lugar)", "Nome", "Verbo"], correct: 0, hint: "Indica de quem √© o l√°pis." }
                        ]
                    },
                    // N√çVEL 2: M√âDIO (4 Quest√µes) - Foco: Completar frases (Contexto)
                    {
                        name: "Aventureiro",
                        questions: [
                            { q: "Eu seguro a bola e diz: '<strong>______</strong> bola √© nova'.", options: ["Esta", "Aquela", "Sua", "Nossa"], correct: 0, hint: "Se est√° na m√£o dele, √© <strong>ESTA</strong>." },
                            { q: "Mam√£e, por favor, me d√° <strong>______</strong> copo que est√° a√≠ com voc√™?", options: ["este", "esse", "aquele", "meu"], correct: 1, hint: "Se est√° com quem ouve (mam√£e), √© <strong>ESSE</strong>." },
                            { q: "Tu esqueceste o ______ caderno?", options: ["meu", "teu", "nosso", "deles"], correct: 1, hint: "Quem fala TU, usa TEU." },
                            { q: "N√≥s vamos arrumar a ______ casa.", options: ["nossa", "tua", "sua", "minha"], correct: 0, hint: "N√≥s cuidamos da <strong>nossa</strong> casa." }
                        ]
                    },
                    // N√çVEL 3: TIT√É (3 Quest√µes) - Foco: An√°lise e Pegadinhas (mais dif√≠cil)
                    {
                        name: "Tit√£",
                        questions: [
                            {
                                q: "Jo√£o disse: 'Este caderno √© meu e aquele √© teu'. Qual caderno est√° mais perto de Jo√£o?",
                                options: ["Nenhum", "O caderno 'teu'", "O caderno 'meu'", "Os dois est√£o longe"],
                                correct: 2,
                                hint: "<strong>ESTE</strong> = perto de quem fala (Jo√£o)."
                            },
                            {
                                q: "Em: 'Maria emprestou seus livros para Ana.' De quem s√£o os livros?",
                                options: ["De Ana", "De Maria", "Das duas", "De ningu√©m"],
                                correct: 1,
                                hint: "Normalmente '<strong>seus</strong>' retoma o sujeito: Maria."
                            },
                            {
                                q: "Di√°logo: ‚Äî Voc√™ trouxe meu casaco? ‚Äî N√£o, eu trouxe ______ casaco. Qual op√ß√£o completa melhor?",
                                options: ["aquele", "este", "teu", "seu"],
                                correct: 2,
                                hint: "Quem fala com 'voc√™' pode usar 'teu' para o casaco de quem ouve."
                            }
                        ]
                    }
                ]
            },
            {
                id: "sz",
                title: "Uso do S e Z",
                icon: "üêç",
                color: "bg-yellow-500",
                description: "Casa ou Caza?",
                levels: [
                    {
                        name: "Iniciante",
                        questions: [
                            { q: "Onde n√≥s moramos? Ca__a.", options: ["Z", "S", "√á", "X"], correct: 1, hint: "Casa se escreve com S." },
                            { q: "Mesa tem som de Z, mas escrevemos com...", options: ["S", "Z", "X", "J"], correct: 0, hint: "Mesa √© com S!" },
                            { q: "Qual animal come√ßa com Z?", options: ["Sapo", "Zebra", "Cobra", "Gato"], correct: 1, hint: "Zebra!" },
                            { q: "Azeite se escreve com...", options: ["Z", "S", "√á", "X"], correct: 0, hint: "Azeite √© com Z." },
                            { q: "Qual palavra est√° escrita certa?", options: ["Cazu", "Casu", "Caso", "Cazo"], correct: 2, hint: "Caso (de acontecer) √© com S." }
                        ]
                    },
                    {
                        name: "Aventureiro",
                        questions: [
                            { q: "Princesa termina igual a...", options: ["Beleza", "Duquesa", "Riqueza", "Cinza"], correct: 1, hint: "T√≠tulos de mulheres (Duquesa, Baronesa) usam S." },
                            { q: "Belo vira Beleza. Rico vira...", options: ["Riquesa", "Riqueza", "Riquessa", "Riquesa"], correct: 1, hint: "Coisas que v√™m de adjetivos usam Z (Riqueza)." },
                            { q: "Japon√™s e Franc√™s. Eles terminam com:", options: ["√äS", "√äZ", "EIZ", "ES"], correct: 0, hint: "Nacionalidades terminam com √äS." },
                            { q: "Pesquisa vem de pesquisar. √â com S ou Z?", options: ["S", "Z", "√á", "X"], correct: 0, hint: "Se a palavra original tem S, a filha tamb√©m tem." }
                        ]
                    },
                    {
                        name: "Tit√£",
                        questions: [
                            {
                                q: "Qual par est√° com as DUAS palavras escritas corretamente?",
                                options: [
                                    "Riqueza e Pobreza",
                                    "Princesa e Rique√ßa",
                                    "Caza e Atraz",
                                    "Meza e Cazo"
                                ],
                                correct: 0,
                                hint: "Riqueza e Pobreza v√™m de adjetivos (rico, pobre) e usam Z."
                            },
                            {
                                q: "Qual frase est√° TODA correta?",
                                options: [
                                    "Ana quize ir ao parque.",
                                    "Ela quis viajar ontem.",
                                    "N√≥s quizeram sair cedo.",
                                    "Ele quisse comer bolo."
                                ],
                                correct: 1,
                                hint: "<strong>Quis</strong> vem de querer e √© com S, sem E no final."
                            },
                            {
                                q: "Em qual palavra o som de Z √© escrito com S?",
                                options: [
                                    "Azeite",
                                    "Mesa",
                                    "Zero",
                                    "Zebra"
                                ],
                                correct: 1,
                                hint: "Em '<strong>mesa</strong>' ouvimos som de Z, mas escrevemos com S."
                            }
                        ]
                    }
                ]
            },
            {
                id: "verbos",
                title: "Verbos",
                icon: "üèÉ",
                color: "bg-green-500",
                description: "A√ß√£o e Movimento",
                levels: [
                    {
                        name: "Iniciante",
                        questions: [
                            { q: "Qual palavra √© uma a√ß√£o (coisa que se faz)?", options: ["Cadeira", "Pular", "Azul", "Pedra"], correct: 1, hint: "Pular √© algo que voc√™ faz." },
                            { q: "O gato <strong>dormiu</strong>. O que o gato fez?", options: ["O", "Gato", "Dormiu", "Fofinho"], correct: 2, hint: "Ele dormiu." },
                            { q: "Complete: O p√°ssaro ______ no c√©u.", options: ["Voa", "Verde", "Grande", "Asa"], correct: 0, hint: "Voa √© a a√ß√£o." },
                            { q: "Qual N√ÉO √© verbo?", options: ["Correr", "Comer", "Bonito", "Falar"], correct: 2, hint: "Bonito √© uma qualidade, n√£o a√ß√£o." },
                            { q: "Choveu muito. Chover √© um verbo de...", options: ["A√ß√£o de pessoa", "Natureza", "Sentimento", "Objeto"], correct: 1, hint: "√â fen√¥meno da natureza." }
                        ]
                    },
                    {
                        name: "Aventureiro",
                        questions: [
                            { q: "Amanh√£ eu ______ bolo.", options: ["Comi", "Como", "Comerei", "Comia"], correct: 2, hint: "Amanh√£ √© futuro: Comerei." },
                            { q: "Ontem eles ______ bola.", options: ["Jogaram", "Jogar√£o", "Joga", "Jogar"], correct: 0, hint: "Passado termina com AM: Jogaram." },
                            { q: "Eu ______ feliz hoje.", options: ["Estou", "Fui", "Serei", "Era"], correct: 0, hint: "Hoje √© presente: Estou." },
                            { q: "Transforme para o passado: Ele canta.", options: ["Ele cantar√°", "Ele cantou", "Ele cantar", "Ele cante"], correct: 1, hint: "J√° aconteceu: Cantou." }
                        ]
                    },
                    {
                        name: "Tit√£",
                        questions: [
                            {
                                q: "Qual frase est√° no PASSADO?",
                                options: [
                                    "Ontem eles jogam bola.",
                                    "Ontem eles jogaram bola.",
                                    "Amanh√£ eles jogaram bola.",
                                    "Hoje eles jogaram bola."
                                ],
                                correct: 1,
                                hint: "Passado: verbo terminado em <strong>-RAM</strong> combina com 'ontem'."
                            },
                            {
                                q: "Qual frase est√° no FUTURO?",
                                options: [
                                    "Ontem eu estudei para a prova.",
                                    "Hoje eu estudo para a prova.",
                                    "Amanh√£ eu estudarei para a prova.",
                                    "Ontem eu estudarei para a prova."
                                ],
                                correct: 2,
                                hint: "Futuro: termina em <strong>-REI</strong> e combina com 'amanh√£'."
                            },
                            {
                                q: "Complete: Amanh√£ n√≥s ______ cedo para viajar.",
                                options: [
                                    "acordamos",
                                    "acord√°vamos",
                                    "acordaremos",
                                    "acordamos ontem"
                                ],
                                correct: 2,
                                hint: "Futuro: '<strong>acordaremos</strong>' combina com 'amanh√£'."
                            }
                        ]
                    }
                ]
            },
            {
                id: "lhli",
                title: "LH e LI",
                icon: "üêá",
                color: "bg-purple-500",
                description: "Orelha ou Orelia?",
                levels: [
                    {
                        name: "Iniciante",
                        questions: [
                            { q: "O coelho comeu a fo__a.", options: ["Lia", "Lha", "La", "Lya"], correct: 1, hint: "Folha √© com LH." },
                            { q: "A minha fami__a √© linda.", options: ["Lha", "Lia", "La", "Lhya"], correct: 1, hint: "Fam√≠lia √© com LI." },
                            { q: "Qual est√° certo?", options: ["Orelha", "Orelia", "Or√©lia", "Orela"], correct: 0, hint: "Orelha com LH." },
                            { q: "Sand√°__a da menina.", options: ["Lha", "Lia", "La", "Lhya"], correct: 1, hint: "Sand√°lia com LI." },
                            { q: "Para tomar sopa uso a...", options: ["Coler", "Colier", "Colher", "Coier"], correct: 2, hint: "Colher com LH." }
                        ]
                    },
                    {
                        name: "Aventureiro",
                        questions: [
                            { q: "J√∫lio ou Julho (m√™s)?", options: ["Julho", "J√∫lio", "Os dois existem", "Nenhum"], correct: 2, hint: "J√∫lio √© nome, Julho √© m√™s. Os dois existem." },
                            { q: "O palha√ßo faz palha√ßada. O que est√° errado?", options: ["Palha√ßo", "Palha√ßada", "Palia√ßo", "Nenhum"], correct: 2, hint: "Palia√ßo n√£o existe, √© com LH." },
                            { q: "Abe__a faz mel.", options: ["Lia", "Lha", "La", "Li"], correct: 1, hint: "Abelha com LH." },
                            { q: "It√°__a (pa√≠s).", options: ["Lha", "Lia", "La", "Li"], correct: 1, hint: "It√°lia com LI." }
                        ]
                    },
                    {
                        name: "Tit√£",
                        questions: [
                            { q: "Complete: O ve__inho lia um livro.", options: ["lh", "li", "l", "i"], correct: 0, hint: "Velhinho (veio de velho) √© com LH." },
                            { q: "Utens√≠__o de cozinha.", options: ["Lio", "Lho", "Li-o", "Lhi-o"], correct: 0, hint: "Utens√≠lio √© com LI." },
                            { q: "Mob√≠__a da casa.", options: ["Lia", "Lha", "La", "Lya"], correct: 0, hint: "Mob√≠lia √© com LI." }
                        ]
                    }
                ]
            },
            {
                id: "tempos",
                title: "Tempos",
                icon: "‚è∞",
                color: "bg-red-500",
                description: "Passado, Presente, Futuro",
                levels: [
                    {
                        name: "Iniciante",
                        questions: [
                            { q: "Ontem eu brinquei. Isso √©:", options: ["Passado (j√° foi)", "Presente (agora)", "Futuro (vai ser)", "Nenhum"], correct: 0, hint: "Ontem j√° passou." },
                            { q: "Amanh√£ n√≥s vamos. Isso √©:", options: ["Passado", "Presente", "Futuro", "Nenhum"], correct: 2, hint: "Amanh√£ ainda vem." },
                            { q: "Eu estou feliz agora. Isso √©:", options: ["Passado", "Presente", "Futuro", "Nenhum"], correct: 1, hint: "Agora √© presente." },
                            { q: "Qual palavra mostra futuro?", options: ["Comi", "Como", "Comerei", "Comia"], correct: 2, hint: "Comerei (vai acontecer)." },
                            { q: "Qual palavra mostra passado?", options: ["Corro", "Corri", "Correrei", "Correr"], correct: 1, hint: "Corri (j√° fiz)." }
                        ]
                    },
                    {
                        name: "Aventureiro",
                        questions: [
                            { q: "Eles brincaram (AM no final).", options: ["Passado", "Futuro", "Presente", "D√∫vida"], correct: 0, hint: "AM no final √© passado." },
                            { q: "Eles brincar√£o (√ÉO no final).", options: ["Passado", "Futuro", "Presente", "D√∫vida"], correct: 1, hint: "√ÉO no final √© futuro." },
                            { q: "Antigamente, as pessoas ______ cartas.", options: ["Escrevem", "Escrever√£o", "Escreviam", "Escreve"], correct: 2, hint: "Antigamente √© passado: Escreviam." },
                            { q: "Semana que vem eu ______.", options: ["Viajei", "Viajo", "Viajarei", "Viajava"], correct: 2, hint: "Semana que vem √© futuro: Viajarei." }
                        ]
                    },
                    {
                        name: "Tit√£",
                        questions: [
                            { q: "Hoje eu estudo. Ontem eu...", options: ["Estudo", "Estudarei", "Estudei", "Estuda"], correct: 2, hint: "Ontem estudei." },
                            { q: "Se eu n√£o comer, eu ______ fome.", options: ["Senti", "Sinto", "Sentirei", "Sentia"], correct: 2, hint: "No futuro, sentirei fome." },
                            { q: "Qual frase est√° correta?", options: ["Ontem eles comer√£o bolo", "Ontem eles comeram bolo", "Amanh√£ eles comeram bolo", "Hoje eles comer√£o bolo"], correct: 1, hint: "Ontem = Passado = AM (Comeram)." }
                        ]
                    }
                ]
            },
            {
                id: "sujeito",
                title: "Sujeito",
                icon: "üîç",
                color: "bg-teal-500",
                description: "Quem fez a a√ß√£o?",
                levels: [
                    {
                        name: "Iniciante",
                        questions: [
                            { q: "<strong>O beb√™</strong> chorou. Quem chorou?", options: ["O beb√™", "Chorou", "Ningu√©m", "O pai"], correct: 0, hint: "O beb√™ √© o sujeito." },
                            { q: "<strong>A menina</strong> correu. O sujeito √©:", options: ["Correu", "A menina", "R√°pido", "Rua"], correct: 1, hint: "A menina praticou a a√ß√£o." },
                            { q: "O cachorro latiu. Quem √© o sujeito?", options: ["Latiu", "O cachorro", "O gato", "Barulho"], correct: 1, hint: "O cachorro fez o barulho." },
                            { q: "N√≥s gostamos de sorvete. Quem gosta?", options: ["Sorvete", "Gostamos", "N√≥s", "De"], correct: 2, hint: "N√≥s gostamos." },
                            { q: "A flor nasceu. Sujeito:", options: ["Nasceu", "Flor", "A flor", "Jardim"], correct: 2, hint: "A flor." }
                        ]
                    },
                    {
                        name: "Aventureiro",
                        questions: [
                            { q: "Minha m√£e fez bolo. O sujeito √©:", options: ["Bolo", "Fez", "Minha m√£e", "Minha"], correct: 2, hint: "Quem fez? Minha m√£e." },
                            { q: "O carro azul quebrou. Sujeito:", options: ["Carro", "Azul", "O carro azul", "Quebrou"], correct: 2, hint: "O sujeito √© tudo: O carro azul." },
                            { q: "Choveu muito ontem. Tem sujeito?", options: ["Sim, a chuva", "N√£o, fen√¥meno da natureza", "Sim, ontem", "Sim, muito"], correct: 1, hint: "Fen√¥menos (chuva, vento) n√£o t√™m sujeito." },
                            { q: "Pedro e Paulo jogaram. Quem √© o sujeito?", options: ["Pedro", "Paulo", "Pedro e Paulo", "Jogaram"], correct: 2, hint: "Os dois juntos s√£o o sujeito." }
                        ]
                    },
                    {
                        name: "Tit√£",
                        questions: [
                            { q: "Sa√≠mos cedo hoje. Quem √© o sujeito?", options: ["Eles", "N√≥s (escondido)", "Eu", "Voc√™s"], correct: 1, hint: "'Sa√≠mos' s√≥ combina com N√ìS." },
                            { q: "Fui ao mercado. Sujeito:", options: ["Ele", "Tu", "Eu (escondido)", "N√≥s"], correct: 2, hint: "'Fui' s√≥ combina com EU." },
                            { q: "Quebrou-se o vaso. O que quebrou?", options: ["O vaso", "Algu√©m", "Ningu√©m", "Ch√£o"], correct: 0, hint: "O vaso √© o sujeito (ele quebrou)." }
                        ]
                    }
                ]
            },
            {
                id: "cedilha",
                title: "Cedilha (√á)",
                icon: "üé™",
                color: "bg-pink-500",
                description: "Regras do √á",
                levels: [
                    {
                        name: "Iniciante",
                        questions: [
                            { q: "Palavra pode come√ßar com √á?", options: ["Sim", "N√£o", "√Äs vezes", "Sempre"], correct: 1, hint: "NUNCA come√ßa com √á." },
                            { q: "Cora__√£o.", options: ["S", "SS", "√á", "Z"], correct: 2, hint: "Cora√ß√£o usa √á." },
                            { q: "Pa__oca.", options: ["√á", "S", "SS", "C"], correct: 0, hint: "Pa√ßoca usa √á." },
                            { q: "A__√∫car.", options: ["S", "Z", "√á", "X"], correct: 2, hint: "A√ß√∫car usa √á." },
                            { q: "Cabe__a.", options: ["S", "√á", "SS", "Z"], correct: 1, hint: "Cabe√ßa usa √á." }
                        ]
                    },
                    {
                        name: "Aventureiro",
                        questions: [
                            { q: "O √á s√≥ aparece antes de quais letras?", options: ["E, I", "A, O, U", "Qualquer uma", "B, C, D"], correct: 1, hint: "S√≥ antes de A, O, U (Ex: √áa, √áo, √áu)." },
                            { q: "Vo__√™. Com C ou √á?", options: ["C", "√á", "S", "SS"], correct: 0, hint: "Antes de E usamos C normal. Voc√™." },
                            { q: "Ba__ia. Com C ou √á?", options: ["C", "√á", "S", "SS"], correct: 0, hint: "Antes de I usamos C normal. Bacia." },
                            { q: "Mo__ bonita.", options: ["√ßa", "sa", "ssa", "za"], correct: 0, hint: "Mo√ßa √© com √á." }
                        ]
                    },
                    {
                        name: "Tit√£",
                        questions: [
                            { q: "Qual palavra est√° errada?", options: ["Cora√ß√£o", "√áapato", "Cabe√ßa", "A√ßude"], correct: 1, hint: "Sapato √© com S. Nunca √á no come√ßo!" },
                            { q: "Palha√ßo e La√ßo. As duas t√™m:", options: ["S", "SS", "√á", "Z"], correct: 2, hint: "As duas usam √á." },
                            { q: "Complete: O ca__ador ca__ou.", options: ["√ß / √ß", "c / c", "s / s", "z / z"], correct: 0, hint: "Ca√ßador e Ca√ßou usam √á." }
                        ]
                    }
                ]
            }
        ];


        // --- L√ìGICA DO JOGO ---
        let gameState = {
            score: parseInt(localStorage.getItem('mestreScore')) || 0,
            unlocked: JSON.parse(localStorage.getItem('mestreUnlocked')) || {},
            // Formato unlock: "topicId-levelIdx": true
            currentTopicIndex: 0,
            currentLevelIndex: 0,
            currentQuestionIndex: 0,
            selectedOptionIndex: null
        };

        // Elementos DOM
        const app = document.getElementById('app');
        const headerLeft = document.getElementById('header-left');
        const scoreDisplay = document.getElementById('score-display');
        const footerAction = document.getElementById('footer-action');
        const footerContent = document.getElementById('footer-content');

        // Inicializa√ß√£o
        function init() {
            // Desbloqueia o primeiro n√≠vel de todos os t√≥picos por padr√£o
            quizData.forEach((topic, idx) => {
                if (!gameState.unlocked[`${idx}-0`]) {
                    gameState.unlocked[`${idx}-0`] = true;
                }
            });
            updateScore();
            renderMap();
        }

        function updateScore() {
            scoreDisplay.textContent = gameState.score;
            localStorage.setItem('mestreScore', gameState.score);
            localStorage.setItem('mestreUnlocked', JSON.stringify(gameState.unlocked));
        }

        // --- RENDERIZAR MAPA ---
        function renderMap() {
            headerLeft.innerHTML = `<span class="text-xl font-bold text-gray-800">üó∫Ô∏è Mapa</span>`;
            footerAction.classList.add('hidden'); // Esconde rodap√© no mapa

            app.innerHTML = `
                <div class="w-full grid gap-4 pb-20 slide-up">
                    ${quizData.map((topic, tIdx) => {
                return `
                        <div class="bg-white rounded-2xl p-4 shadow-sm border-2 border-gray-100">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="${topic.color} w-12 h-12 rounded-xl flex items-center justify-center text-2xl text-white shadow-btn">
                                    ${topic.icon}
                                </div>
                                <div>
                                    <h2 class="text-lg font-bold text-gray-700 leading-tight">${topic.title}</h2>
                                    <p class="text-xs text-gray-400">${topic.description}</p>
                                </div>
                            </div>
                            
                            <div class="flex gap-2">
                                ${topic.levels.map((lvl, lIdx) => {
                    const levelKey = `${tIdx}-${lIdx}`;
                    const isUnlocked = gameState.unlocked[levelKey];
                    const isCompleted = gameState.unlocked[`${tIdx}-${lIdx}_done`]; // Marca√ß√£o extra para conclu√≠do

                    let btnClass = isUnlocked
                        ? (lIdx === 2 ? 'bg-purple-100 text-purple-700 border-purple-300' : 'bg-blue-50 text-blue-600 border-blue-200')
                        : 'bg-gray-100 text-gray-400 border-gray-200 cursor-not-allowed';

                    if (isCompleted) btnClass = 'bg-green-100 text-green-700 border-green-300';

                    const label = lIdx === 2 ? 'TIT√É ‚ö°' : lvl.name;
                    const icon = isUnlocked ? (isCompleted ? '‚úÖ' : '‚ñ∂Ô∏è') : 'üîí';

                    return `
                                    <button onclick="${isUnlocked ? `startLevel(${tIdx}, ${lIdx})` : ''}" 
                                        class="flex-1 py-2 rounded-xl border-b-4 text-xs font-bold transition-all ${btnClass} ${isUnlocked ? 'active:border-b-0 active:translate-y-1' : ''}">
                                        <div class="uppercase opacity-70 text-[10px] mb-1">${label}</div>
                                        <div class="text-base">${icon}</div>
                                    </button>
                                    `;
                }).join('')}
                            </div>
                        </div>
                        `;
            }).join('')}
                </div>
            `;
            window.scrollTo(0, 0);
        }

        // --- INICIAR N√çVEL ---
        function startLevel(tIdx, lIdx) {
            gameState.currentTopicIndex = tIdx;
            gameState.currentLevelIndex = lIdx;
            gameState.currentQuestionIndex = 0;
            renderQuestion();
        }

        // --- RENDERIZAR QUEST√ÉO ---
        function renderQuestion() {
            const topic = quizData[gameState.currentTopicIndex];
            const level = topic.levels[gameState.currentLevelIndex];
            const question = level.questions[gameState.currentQuestionIndex];
            const isTitan = gameState.currentLevelIndex === 2;

            // Header do Jogo
            headerLeft.innerHTML = `
                <button onclick="renderMap()" class="bg-gray-100 p-2 rounded-full text-sm font-bold text-gray-500 hover:bg-gray-200">
                    ‚¨Ö Sair
                </button>
            `;

            // Barra de Progresso
            const progress = ((gameState.currentQuestionIndex) / level.questions.length) * 100;

            app.innerHTML = `
                <div class="w-full mb-6 mt-2">
                    <div class="flex justify-between text-xs font-bold text-gray-400 uppercase mb-1 px-1">
                        <span>${isTitan ? '‚ö° Modo Tit√£' : level.name}</span>
                        <span>${gameState.currentQuestionIndex + 1}/${level.questions.length}</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
                        <div class="h-full transition-all duration-300 ${isTitan ? 'bg-purple-500' : topic.color.replace('bg-', 'bg-')}" style="width: ${progress}%"></div>
                    </div>
                </div>

                <div class="w-full bg-white rounded-3xl p-6 shadow-sm border-2 ${isTitan ? 'border-purple-300 shadow-[0_0_15px_rgba(168,85,247,0.2)]' : 'border-gray-100'} pop-in mb-24">
                    <h2 class="text-xl md:text-2xl font-bold text-gray-800 mb-6 leading-snug text-center">
                        ${formatText(question.q)}
                    </h2>

                    <div class="grid gap-3">
                        ${question.options.map((opt, idx) => `
                            <button onclick="selectOption(${idx})" id="opt-${idx}"
                                class="w-full text-left p-4 rounded-xl border-2 border-gray-200 bg-gray-50 font-bold text-gray-600 transition-all active:scale-95 btn-press">
                                ${opt}
                            </button>
                        `).join('')}
                    </div>
                </div>
            `;

            // Resetar Rodap√© Fixo
            gameState.selectedOptionIndex = null;
            footerAction.classList.remove('hidden');
            footerAction.className = "fixed-footer bg-white border-t-2 border-gray-100";

            footerContent.innerHTML = `
                <button class="w-full bg-gray-200 text-gray-400 font-bold py-4 rounded-2xl text-lg cursor-not-allowed shadow-none" disabled>
                    Escolha uma resposta
                </button>
            `;

            window.scrollTo(0, 0);
        }

        // Formata√ß√£o simples (Negrito)
        function formatText(text) {
            return text.replace(/\*\*(.*?)\*\*/g, '<span class="text-blue-600">$1</span>')
                .replace(/__/g, '<span class="inline-block w-8 border-b-2 border-gray-400"></span>');
        }

        // --- SELECIONAR OP√á√ÉO ---
        function selectOption(idx) {
            if (document.getElementById(`opt-${idx}`).disabled) return;

            // Limpa anteriores
            document.querySelectorAll('[id^="opt-"]').forEach(btn => {
                btn.className = "w-full text-left p-4 rounded-xl border-2 border-gray-200 bg-gray-50 font-bold text-gray-600 transition-all btn-press";
            });

            // Marca atual
            const btn = document.getElementById(`opt-${idx}`);
            btn.className = "w-full text-left p-4 rounded-xl border-2 border-blue-400 bg-blue-50 font-bold text-blue-600 transition-all btn-press shadow-btn transform -translate-y-1";

            gameState.selectedOptionIndex = idx;

            // Ativa bot√£o no rodap√©
            const topicColor = quizData[gameState.currentTopicIndex].color;
            footerContent.innerHTML = `
                <button onclick="checkAnswer()" class="w-full ${topicColor} hover:opacity-90 text-white font-bold py-4 rounded-2xl text-lg shadow-btn btn-press uppercase tracking-wide">
                    Confirmar
                </button>
            `;
        }

        // --- VERIFICAR RESPOSTA ---
        function checkAnswer() {
            const topic = quizData[gameState.currentTopicIndex];
            const level = topic.levels[gameState.currentLevelIndex];
            const question = level.questions[gameState.currentQuestionIndex];
            const isCorrect = gameState.selectedOptionIndex === question.correct;

            // Trava op√ß√µes
            document.querySelectorAll('[id^="opt-"]').forEach(btn => {
                btn.disabled = true;
                btn.classList.remove('btn-press', 'active:scale-95');
                btn.style.transform = "none";
            });

            const selBtn = document.getElementById(`opt-${gameState.selectedOptionIndex}`);
            const corrBtn = document.getElementById(`opt-${question.correct}`);

            if (isCorrect) {
                selBtn.className = "w-full text-left p-4 rounded-xl border-2 border-green-500 bg-green-100 text-green-700 font-bold shadow-none";
                selBtn.innerHTML += ` <span class="float-right text-xl">‚úÖ</span>`;
                gameState.score += 10;
                updateScore();
                // Confete
                confetti({ particleCount: 50, spread: 60, origin: { y: 0.8 } });
            } else {
                selBtn.className = "w-full text-left p-4 rounded-xl border-2 border-red-400 bg-red-100 text-red-700 font-bold opacity-80 shadow-none";
                selBtn.innerHTML += ` <span class="float-right text-xl">‚ùå</span>`;
                corrBtn.className = "w-full text-left p-4 rounded-xl border-2 border-green-500 bg-green-100 text-green-700 font-bold animate-pulse shadow-none";
            }

            // --- FEEDBACK NO RODAP√â FIXO (Segredo da Usabilidade) ---
            const isLast = gameState.currentQuestionIndex === level.questions.length - 1;

            footerAction.className = `fixed-footer ${isCorrect ? 'bg-green-50 border-t-2 border-green-200' : 'bg-red-50 border-t-2 border-red-200'} slide-up`;

            footerContent.innerHTML = `
                <div class="flex flex-col gap-3">
                    <div class="flex items-start gap-3">
                        <div class="text-3xl bg-white rounded-full p-1 shadow-sm">${isCorrect ? 'üéâ' : 'üí°'}</div>
                        <div>
                            <p class="font-black ${isCorrect ? 'text-green-700' : 'text-red-600'} uppercase text-sm mb-1">
                                ${isCorrect ? 'Incr√≠vel!' : 'Corre√ß√£o:'}
                            </p>
                            <p class="text-gray-700 text-sm font-medium leading-snug">${question.hint}</p>
                        </div>
                    </div>
                    <button onclick="${isLast ? 'finishLevel()' : 'nextQuestion()'}" 
                        class="w-full ${isCorrect ? 'bg-green-500' : 'bg-gray-700'} text-white font-bold py-3 rounded-2xl text-lg shadow-btn btn-press uppercase tracking-wider mt-1">
                        ${isLast ? 'Concluir' : 'Continuar'}
                    </button>
                </div>
            `;
        }

        function nextQuestion() {
            gameState.currentQuestionIndex++;
            renderQuestion();
        }

        // --- TELA DE VIT√ìRIA / DECIS√ÉO ---
        function finishLevel() {
            const topic = quizData[gameState.currentTopicIndex];
            const nextLevelIdx = gameState.currentLevelIndex + 1;
            const hasNextLevel = nextLevelIdx < topic.levels.length;

            // Salvar progresso
            const levelKey = `${gameState.currentTopicIndex}-${gameState.currentLevelIndex}`;
            gameState.unlocked[levelKey] = true; // Desbloqueado (j√° estava)
            gameState.unlocked[`${levelKey}_done`] = true; // Conclu√≠do

            if (hasNextLevel) {
                gameState.unlocked[`${gameState.currentTopicIndex}-${nextLevelIdx}`] = true; // Desbloqueia pr√≥ximo
            }
            // Desbloqueia pr√≥ximo t√≥pico n√≠vel 0 se terminar qualquer n√≠vel do atual (L√≥gica flex√≠vel)
            const nextTopicIdx = gameState.currentTopicIndex + 1;
            if (nextTopicIdx < quizData.length) {
                gameState.unlocked[`${nextTopicIdx}-0`] = true;
            }

            updateScore();
            confetti({ particleCount: 200, spread: 100, origin: { y: 0.6 } });

            footerAction.classList.add('hidden'); // Esconde rodap√©

            app.innerHTML = `
                <div class="text-center mt-8 pop-in w-full max-w-sm">
                    <div class="text-7xl mb-4 animate-bounce">üèÜ</div>
                    <h2 class="text-3xl font-black text-gray-800 mb-2">Vit√≥ria!</h2>
                    <p class="text-gray-500 mb-8 font-medium">Voc√™ completou o n√≠vel!</p>

                    <div class="grid gap-4 w-full">
                        ${hasNextLevel ? `
                            <button onclick="startLevel(${gameState.currentTopicIndex}, ${nextLevelIdx})" 
                                class="w-full bg-gradient-to-r from-purple-500 to-purple-600 text-white p-5 rounded-3xl shadow-lg btn-press flex items-center justify-between group relative overflow-hidden">
                                <div class="text-left">
                                    <p class="text-[10px] uppercase opacity-80 font-bold tracking-widest">Subir de N√≠vel</p>
                                    <p class="text-xl font-bold">Ir para ${topic.levels[nextLevelIdx].name}</p>
                                </div>
                                <span class="text-3xl bg-white/20 rounded-full w-10 h-10 flex items-center justify-center">‚¨ÜÔ∏è</span>
                            </button>
                        ` : `
                             <div class="bg-yellow-100 p-6 rounded-3xl text-yellow-800 font-bold border-2 border-yellow-300 shadow-sm">
                                üëë Voc√™ virou um Mestre neste assunto!
                             </div>
                        `}

                        ${nextTopicIdx < quizData.length ? `
                            <button onclick="startLevel(${nextTopicIdx}, 0)" 
                                class="w-full bg-white border-2 border-gray-200 text-gray-600 p-4 rounded-3xl shadow-sm btn-press flex items-center justify-between hover:bg-gray-50">
                                <div class="text-left">
                                    <p class="text-[10px] uppercase opacity-60 font-bold tracking-widest">Novo Assunto</p>
                                    <p class="text-lg font-bold text-gray-800">${quizData[nextTopicIdx].title}</p>
                                </div>
                                <span class="text-2xl">‚û°</span>
                            </button>
                        ` : ''}

                        <button onclick="renderMap()" class="text-gray-400 font-bold py-4 text-sm mt-2">Voltar ao Mapa</button>
                    </div>
                </div>
            `;
        }

        // Inicia App
        init();

    </script>
</body>

</html>